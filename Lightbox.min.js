(function(window){"use strict";function Lightbox(params){var self=this;this.dragdealer=null;this.settings={items:[],itemsKey:0,container:document.querySelector("body"),backgroundHtml:'<div class="lightbox-background lightbox-opacity-animation"></div>',closeHtml:'<div class="lightbox-close lightbox-opacity-animation"></div>',contentContainerHtml:'<div class="lightbox-content-container lightbox-opacity-animation"></div>',multipleItemsClass:"multiple-items",multipleItemsContainerHtml:"<div></div>",multipleItemsContainerClass:"lightbox-multiple-items-container",contentHtml:'<div class="lightbox-content"></div>',contentClassIos:"ios",contentClassIframe:"lightbox-content-iframe",contentClassImage:"lightbox-content-image",contentClassGet:"lightbox-content-ajax lightbox-content-get",contentClassPost:"lightbox-content-ajax lightbox-content-post",executeAjaxScript:!0,iframeClass:"lightbox-iframe",iframeTransparencyMode:!0,htmlActiveClass:"lightbox-active",previousHtml:'<div class="lightbox-previous lightbox-opacity-animation"></div>',nextHtml:'<div class="lightbox-next lightbox-opacity-animation"></div>',infoHtml:'<div class="lightbox-info lightbox-opacity-animation"></div>',loadingHtml:'<div class="lightbox-loading lightbox-opacity-animation"><i class="fa fa-spinner fa-spin fa-fw"></i></div>',closeOnBackgroundClick:!0,imageLoadTimeout:10,pathToRequirejsDragdealer:"dragdealer.min"};if(typeof params==="object"){for(var key in params){if(params.hasOwnProperty(key)&&typeof this.settings[key]!=="undefined"){this.settings[key]=params[key]}}}
this.backgroundElement=null;this.closeElement=null;this.contentContainerElement=null;this.infoElement=null;this.previousElement=null;this.nextElement=null;var Element=function(html){var selfElem=this;this.isVisible=!0;this.html=html.trim();this.element=null;this.get=function(){if(this.element===null||typeof this.element!=="object"){if("content" in document.createElement("template")){var template=document.createElement("template");template.innerHTML=this.html;this.element=template.content.firstChild}else{var div=document.createElement("div");div.innerHTML=this.html;this.element=div.firstChild}}
return this.element};this.show=function(){if(this.isVisible===!1){this.get().style.opacity=1;this.isVisible=!0}
return this};this.hide=function(){if(this.isVisible===!0&&this.get()){this.get().style.opacity=0;this.isVisible=!1}
return this};this.remove=function(){if(this.get()&&this.get().parentNode){this.get().parentNode.removeChild(this.get())}
return this};this.hideAndRemove=function(cb){this.hide();window.setTimeout(function(){selfElem.remove();if(typeof cb==="function"){cb()}},300);return this};this.addClass=function(c){if(!this.get()){return this}
if(c.trim().indexOf(" ")>=0){var cc=c.split(" ");for(var i=0;i<cc.length;i++){if(cc[i].trim()){this.get().classList.add(cc[i].trim())}}}else{this.get().classList.add(c.trim())}
return this};this.removeClass=function(c){if(!this.get()){return this}
if(c.trim().indexOf(" ")>=0){var cc=c.split(" ");for(var i=0;i<cc.length;i++){if(cc[i].trim()){this.get().classList.remove(cc[i])}}}else{this.get().classList.remove(c.trim())}
return this};this.preventTouchmove=function(){self.event.addEvent(this.get(),"touchmove",self.event.preventDefault)};return this};this.set=function(key,value){if(typeof this.settings[key]!=="undefined"){this.settings[key]=value}
return this};this.addItem=function(params){if(typeof params.target!=="string"){return null}
this.settings.items.push({target:params.target,mode:params.mode||"iframe",title:params.title||"",data:params.data||null,callback:params.callback||null});return this};this.event={addEvent:function(elem,event,fn){elem.addEventListener(event,fn,!1)},removeEvent:function(elem,event,fn){elem.removeEventListener(event,fn,!1)},preventDefault:function(evt){evt.preventDefault()},itemCallback:function(item){if(item.callback&&typeof item.callback==="function"){item.callback(item,self)}}};this.executeScript=function(html){var scripts=[];while(html.indexOf("<script")>-1||html.indexOf("</script")>-1){var start_a=html.indexOf("<script");var start_o=html.indexOf(">",start_a);var end_a=html.indexOf("</script",start_a);var end_o=html.indexOf(">",end_a);scripts.push(html.substring(start_o+1,end_a));html=html.substring(0,start_a)+html.substring(end_o+1)}
for(var i=0;i<scripts.length;i++){try{eval(scripts[i])}catch(e){console.log(e)}}};this.open=function(){if(typeof this.settings.items[this.settings.itemsKey]!=="object"){console.log("Error in Lightbox: No items defined!");return null}
this.backgroundElement=new Element(this.settings.backgroundHtml);this.backgroundElement.hide();this.backgroundElement.preventTouchmove();this.settings.container.appendChild(this.backgroundElement.get());this.backgroundElement.show();if(this.settings.closeOnBackgroundClick===!0){this.event.addEvent(this.backgroundElement.get(),"click",function(){self.close()})}
this.closeElement=new Element(this.settings.closeHtml);this.closeElement.preventTouchmove();this.closeElement.hide();this.settings.container.appendChild(this.closeElement.get());this.closeElement.show();this.event.addEvent(this.closeElement.get(),"click",function(){self.close()});this.contentContainerElement=new Element(this.settings.contentContainerHtml);this.settings.container.appendChild(this.contentContainerElement.get());this.contentContainerElement.multipleItemsContainer=null;this.contentContainerElement.addContentElement=function(ceToAdd){if(self.settings.items.length>1){if(this.multipleItemsContainer===null){this.multipleItemsContainer=new Element(self.settings.multipleItemsContainerHtml);this.multipleItemsContainer.addClass(self.settings.multipleItemsContainerClass);this.multipleItemsContainer.get().style.width=self.settings.items.length*100+"%";this.get().appendChild(this.multipleItemsContainer.get())}
ceToAdd.style.width=100/self.settings.items.length+"%";this.multipleItemsContainer.get().appendChild(ceToAdd)}else{this.get().appendChild(ceToAdd)}};this.infoElement=new Element(this.settings.infoHtml);this.infoElement.preventTouchmove();this.settings.container.appendChild(this.infoElement.get());if(this.settings.items.length>1){this.previousElement=new Element(this.settings.previousHtml);this.previousElement.preventTouchmove();this.event.addEvent(this.previousElement.get(),"click",function(){self.showPreviousItem()});this.settings.container.appendChild(this.previousElement.get());this.nextElement=new Element(this.settings.nextHtml);this.nextElement.preventTouchmove();this.event.addEvent(this.nextElement.get(),"click",function(){self.showNextItem()});this.settings.container.appendChild(this.nextElement.get());this.infoElement.addClass(this.settings.multipleItemsClass);this.contentContainerElement.addClass(this.settings.multipleItemsClass);for(var e=0;e<this.settings.items.length;e++){this.addContent(this.settings.items[e])}
var dragdealerConfiguration={steps:self.settings.items.length,speed:0.3,loose:!0,requestAnimationFrame:!0,handleClass:self.settings.multipleItemsContainerClass,callback:function(){var s=self.dragdealer.getStep()[0];self.settings.itemsKey=s;self.infoElement.get().innerHTML=self.settings.items[s-1].title?s+"/"+self.settings.items.length+" - "+self.settings.items[s-1].title:s+"/"+self.settings.items.length}};if(this.settings.pathToRequirejsDragdealer){require([this.settings.pathToRequirejsDragdealer],function(Dragdealer){self.dragdealer=new Dragdealer(self.contentContainerElement.get(),dragdealerConfiguration);self.dragdealer.setStep(self.settings.itemsKey+1)})}else{self.dragdealer=new Dragdealer(self.contentContainerElement.get(),dragdealerConfiguration);self.dragdealer.setStep(self.settings.itemsKey+1)}}else{this.addContent(this.settings.items[this.settings.itemsKey])}
document.querySelector("html").classList.add(this.settings.htmlActiveClass);this.enableKeyboard();return this};this.addContent=function(item){switch(item.mode){case "iframe":this.addContentIframe(item);break;case "get":this.addContentAjax(item,"get");break;case "post":this.addContentAjax(item,"post");break;case "image":this.addContentImage(item);break}};this.addContentIframe=function(item){item.contentElement=new Element(this.settings.contentHtml);item.contentElement.addClass(this.settings.contentClassIframe);this.contentContainerElement.addContentElement(item.contentElement.get());item.loadingElement=new Element(this.settings.loadingHtml);item.contentElement.get().appendChild(item.loadingElement.get());var isIOS=!1;if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){item.contentElement.addClass(this.settings.contentClassIos);item.contentElement.get().style.overflow="hidden";isIOS=!0}
var iframe=new Element('<iframe src="'+item.target+'" class="'+this.settings.iframeClass+'" frameborder="0" scrolling="'+(isIOS?"no":"yes")+'"></iframe>');iframe.hide();if(this.settings.iframeTransparencyMode){iframe.get().setAttribute("allowtransparency","true");iframe.get().style.backgroundColor="transparent"}
item.contentElement.get().appendChild(iframe.get());this.event.addEvent(iframe.get(),"load",function(){iframe.show();item.loadingElement.hideAndRemove();if(item.title&&self.settings.items.length===1){self.infoElement.get().innerHTML=item.title}
self.event.itemCallback(item);if(isIOS){setTimeout(function(){item.contentElement.get().style.overflow="scroll";iframe.get().style.height=iframe.get().contentDocument.body.scrollHeight+"px"},200)}})};this.addContentAjax=function(item,method){item.contentElement=new Element(this.settings.contentHtml);item.contentElement.addClass(method==="get"?this.settings.contentClassGet:this.settings.contentClassPost);this.contentContainerElement.addContentElement(item.contentElement.get());item.loadingElement=new Element(this.settings.loadingHtml);item.contentElement.get().appendChild(item.loadingElement.get());if(navigator.userAgent.match(/(iPod|iPhone|iPad)/)){item.contentElement.addClass(this.settings.contentClassIos)}
var xhr=new XMLHttpRequest();xhr.open(method==="get"?"GET":"POST",item.target);this.event.addEvent(xhr,"load",function(evt){if(xhr.status>=200&&xhr.status<300){item.contentElement.get().innerHTML=xhr.responseText;self.event.itemCallback(item);if(self.settings.executeAjaxScript){self.executeScript(xhr.responseText)}}else{item.contentElement.get().innerHTML="ERROR: could not load content from "+item.target+"!";console.warn(xhr.statusText,xhr.responseText)}});xhr.send(method==="post"&&item.data?item.data:null)};this.addContentImage=function(item){item.contentElement=new Element(this.settings.contentHtml);item.contentElement.addClass(this.settings.contentClassImage);this.contentContainerElement.addContentElement(item.contentElement.get());item.loadingElement=new Element(this.settings.loadingHtml);item.contentElement.get().appendChild(item.loadingElement.get());this.loadImage(item,function(item,state){item.loadingElement.hideAndRemove();switch(state){case "error":item.contentElement.get().innerHTML="ERROR: could not load the image from "+item.target+".";break;case "timeout":item.contentElement.get().innerHTML="ERROR: loading the image from "+item.target+" took too long.";break;default:item.contentElement.get().style.backgroundImage="url("+item.target+")";if(item.title&&self.settings.items.length===1){self.infoElement.get().innerHTML=item.title}
self.event.itemCallback(item);break}},self.settings.imageLoadTimeout*1000)};this.loadImage=function(item,cb,timeout){timeout=timeout||self.settings.imageLoadTimeout*1000;var timedOut=!1,timer;var img=new Image();img.onerror=img.onabort=function(){if(!timedOut){clearTimeout(timer);cb(item,"error")}};img.onload=function(){if(!timedOut){clearTimeout(timer);cb(item,"success")}};img.src=item.target;timer=setTimeout(function(){timedOut=!0;img.src="//!!!!/test.jpg";cb(item,"timeout")},timeout)};this.showNextItem=function(){if(!this.dragdealer){return}
this.settings.itemsKey=this.settings.itemsKey+1<=this.settings.items.length?this.settings.itemsKey+1:1;this.dragdealer.setStep(this.settings.itemsKey)};this.showPreviousItem=function(){if(!this.dragdealer){return}
this.settings.itemsKey=this.settings.itemsKey-1>0?this.settings.itemsKey-1:this.settings.items.length;this.dragdealer.setStep(this.settings.itemsKey)};var NSEvents={on:function(event,cb,opts){if(typeof this.namespaces!=="object"){this.namespaces={}}
this.namespaces[event]=cb;var options=opts?opts:!1;this.addEventListener(event.split(".")[0],cb,options);return this},off:function(event){this.removeEventListener(event.split(".")[0],this.namespaces[event]);delete this.namespaces[event];return this}};this.enableKeyboard=function(){document.on=Element.prototype.on=NSEvents.on;document.off=Element.prototype.off=NSEvents.off;document.on("keydown.Lighbox",function(event){switch(event.which){case 39:if(self.settings.items.length>1){self.showNextItem()}
break;case 37:if(self.settings.items.length>1){self.showPreviousItem()}
break;case 27:if(self.settings.closeOnBackgroundClick===!0){self.close()}
break}})};this.disableKeyboard=function(){document.off("keydown.Lighbox")};this.close=function(){if(this.backgroundElement){this.backgroundElement.hideAndRemove(function(){self.backgroundElement=null})}
if(this.closeElement){this.closeElement.hideAndRemove(function(){self.closeElement=null})}
if(this.contentContainerElement){this.contentContainerElement.remove();this.contentContainerElement=null}
if(this.infoElement){this.infoElement.remove();this.infoElement=null}
if(this.previousElement){this.previousElement.hideAndRemove(function(){self.previousElement=null})}
if(this.nextElement){this.nextElement.hideAndRemove(function(){self.nextElement=null})}
document.querySelector("html").classList.remove(this.settings.htmlActiveClass);this.disableKeyboard();return this}}
if(typeof define==="function"&&define.amd){define(function(){return Lightbox})}else{window.Lightbox=Lightbox}})(window)