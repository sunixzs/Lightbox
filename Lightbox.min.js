(function(window){"use strict";function Lightbox(params){var self=this;if(this.dragdealer=null,this.settings={items:[],itemsKey:0,container:document.querySelector("body"),backgroundHtml:"<div class=\"lightbox-background lightbox-opacity-animation\"></div>",closeHtml:"<div class=\"lightbox-close lightbox-opacity-animation\"></div>",contentContainerHtml:"<div class=\"lightbox-content-container lightbox-opacity-animation\"></div>",multipleItemsClass:"multiple-items",multipleItemsContainerHtml:"<div></div>",multipleItemsContainerClass:"lightbox-multiple-items-container",contentHtml:"<div class=\"lightbox-content\"></div>",contentClassIos:"ios",contentClassIframe:"lightbox-content-iframe",contentClassImage:"lightbox-content-image",contentClassGet:"lightbox-content-ajax lightbox-content-get",contentClassPost:"lightbox-content-ajax lightbox-content-post",executeAjaxScript:!0,iframeClass:"lightbox-iframe",iframeTransparencyMode:!0,htmlActiveClass:"lightbox-active",previousHtml:"<div class=\"lightbox-previous lightbox-opacity-animation\"></div>",nextHtml:"<div class=\"lightbox-next lightbox-opacity-animation\"></div>",infoHtml:"<div class=\"lightbox-info lightbox-opacity-animation\"></div>",loadingHtml:"<div class=\"lightbox-loading lightbox-opacity-animation\"><i class=\"fa fa-spinner fa-spin fa-fw\"></i></div>",closeOnBackgroundClick:!0,imageLoadTimeout:10,pathToRequirejsDragdealer:"dragdealer.min"},"object"==typeof params)for(var key in params)params.hasOwnProperty(key)&&"undefined"!=typeof this.settings[key]&&(this.settings[key]=params[key]);this.backgroundElement=null,this.closeElement=null,this.contentContainerElement=null,this.infoElement=null,this.previousElement=null,this.nextElement=null;var Element=function(a){var b=this;return this.isVisible=!0,this.html=a.trim(),this.element=null,this.get=function(){if(null===this.element||"object"!=typeof this.element)if("content"in document.createElement("template")){var d=document.createElement("template");d.innerHTML=this.html,this.element=d.content.firstChild}else{var f=document.createElement("div");f.innerHTML=this.html,this.element=f.firstChild}return this.element},this.show=function(){return!1===this.isVisible&&(this.get().style.opacity=1,this.isVisible=!0),this},this.hide=function(){return!0===this.isVisible&&this.get()&&(this.get().style.opacity=0,this.isVisible=!1),this},this.remove=function(){return this.get()&&this.get().parentNode&&this.get().parentNode.removeChild(this.get()),this},this.hideAndRemove=function(d){return this.hide(),window.setTimeout(function(){b.remove(),"function"==typeof d&&d()},300),this},this.addClass=function(d){if(!this.get())return this;if(0<=d.trim().indexOf(" "))for(var f=d.split(" "),g=0;g<f.length;g++)f[g].trim()&&this.get().classList.add(f[g].trim());else this.get().classList.add(d.trim());return this},this.removeClass=function(d){if(!this.get())return this;if(0<=d.trim().indexOf(" "))for(var f=d.split(" "),g=0;g<f.length;g++)f[g].trim()&&this.get().classList.remove(f[g]);else this.get().classList.remove(d.trim());return this},this.preventTouchmove=function(){self.event.addEvent(this.get(),"touchmove",self.event.preventDefault)},this};this.set=function(a,b){return"undefined"!=typeof this.settings[a]&&(this.settings[a]=b),this},this.addItem=function(a){return"string"==typeof a.target?(this.settings.items.push({target:a.target,mode:a.mode||"iframe",title:a.title||"",data:a.data||null,callback:a.callback||null}),this):null},this.event={addEvent:function(a,b,d){a.addEventListener(b,d,!1)},removeEvent:function(a,b,d){a.removeEventListener(b,d,!1)},preventDefault:function(a){a.preventDefault()},itemCallback:function(a){a.callback&&"function"==typeof a.callback&&a.callback(a,self)}},this.executeScript=function(html){for(var scripts=[];-1<html.indexOf("<script")||-1<html.indexOf("</script");){var start_a=html.indexOf("<script"),start_o=html.indexOf(">",start_a),end_a=html.indexOf("</script",start_a),end_o=html.indexOf(">",end_a);scripts.push(html.substring(start_o+1,end_a)),html=html.substring(0,start_a)+html.substring(end_o+1)}for(var i=0;i<scripts.length;i++)try{eval(scripts[i])}catch(a){console.log(a)}},this.open=function(){if("object"!=typeof this.settings.items[this.settings.itemsKey])return console.log("Error in Lightbox: No items defined!"),null;if(this.backgroundElement=new Element(this.settings.backgroundHtml),this.backgroundElement.hide(),this.backgroundElement.preventTouchmove(),this.settings.container.appendChild(this.backgroundElement.get()),this.backgroundElement.show(),!0===this.settings.closeOnBackgroundClick&&this.event.addEvent(this.backgroundElement.get(),"click",function(){self.close()}),this.closeElement=new Element(this.settings.closeHtml),this.closeElement.preventTouchmove(),this.closeElement.hide(),this.settings.container.appendChild(this.closeElement.get()),this.closeElement.show(),this.event.addEvent(this.closeElement.get(),"click",function(){self.close()}),this.contentContainerElement=new Element(this.settings.contentContainerHtml),this.settings.container.appendChild(this.contentContainerElement.get()),this.contentContainerElement.multipleItemsContainer=null,this.contentContainerElement.addContentElement=function(d){1<self.settings.items.length?(null===this.multipleItemsContainer&&(this.multipleItemsContainer=new Element(self.settings.multipleItemsContainerHtml),this.multipleItemsContainer.addClass(self.settings.multipleItemsContainerClass),this.multipleItemsContainer.get().style.width=100*self.settings.items.length+"%",this.get().appendChild(this.multipleItemsContainer.get())),d.style.width=100/self.settings.items.length+"%",this.multipleItemsContainer.get().appendChild(d)):this.get().appendChild(d)},this.infoElement=new Element(this.settings.infoHtml),this.infoElement.preventTouchmove(),this.settings.container.appendChild(this.infoElement.get()),1<this.settings.items.length){this.previousElement=new Element(this.settings.previousHtml),this.previousElement.preventTouchmove(),this.event.addEvent(this.previousElement.get(),"click",function(){self.showPreviousItem()}),this.settings.container.appendChild(this.previousElement.get()),this.nextElement=new Element(this.settings.nextHtml),this.nextElement.preventTouchmove(),this.event.addEvent(this.nextElement.get(),"click",function(){self.showNextItem()}),this.settings.container.appendChild(this.nextElement.get()),this.infoElement.addClass(this.settings.multipleItemsClass),this.contentContainerElement.addClass(this.settings.multipleItemsClass);for(var a=0;a<this.settings.items.length;a++)this.addContent(this.settings.items[a]);var b={steps:self.settings.items.length,speed:0.3,loose:!0,requestAnimationFrame:!0,handleClass:self.settings.multipleItemsContainerClass,callback:function(){var d=self.dragdealer.getStep()[0];self.settings.itemsKey=d,self.infoElement.get().innerHTML=self.settings.items[d-1].title?d+"/"+self.settings.items.length+" - "+self.settings.items[d-1].title:d+"/"+self.settings.items.length}};this.settings.pathToRequirejsDragdealer?require([this.settings.pathToRequirejsDragdealer],function(d){self.dragdealer=new d(self.contentContainerElement.get(),b),self.dragdealer.setStep(self.settings.itemsKey+1)}):(self.dragdealer=new Dragdealer(self.contentContainerElement.get(),b),self.dragdealer.setStep(self.settings.itemsKey+1))}else this.addContent(this.settings.items[this.settings.itemsKey]);return document.querySelector("html").classList.add(this.settings.htmlActiveClass),this.enableKeyboard(),this},this.addContent=function(a){switch(a.mode){case"iframe":this.addContentIframe(a);break;case"get":this.addContentAjax(a,"get");break;case"post":this.addContentAjax(a,"post");break;case"image":this.addContentImage(a);}},this.addContentIframe=function(a){a.contentElement=new Element(this.settings.contentHtml),a.contentElement.addClass(this.settings.contentClassIframe),this.contentContainerElement.addContentElement(a.contentElement.get()),a.loadingElement=new Element(this.settings.loadingHtml),a.contentElement.get().appendChild(a.loadingElement.get());var b=!1;navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&(a.contentElement.addClass(this.settings.contentClassIos),a.contentElement.get().style.overflow="hidden",b=!0);var d=new Element("<iframe src=\""+a.target+"\" class=\""+this.settings.iframeClass+"\" frameborder=\"0\" scrolling=\""+(b?"no":"yes")+"\"></iframe>");d.hide(),this.settings.iframeTransparencyMode&&(d.get().setAttribute("allowtransparency","true"),d.get().style.backgroundColor="transparent"),a.contentElement.get().appendChild(d.get()),this.event.addEvent(d.get(),"load",function(){d.show(),a.loadingElement.hideAndRemove(),a.title&&1===self.settings.items.length&&(self.infoElement.get().innerHTML=a.title),self.event.itemCallback(a),b&&(a.contentElement.get().style.overflow="auto",d.get().style.height=d.get().contentDocument.body.scrollHeight+"px")})},this.addContentAjax=function(a,b){a.contentElement=new Element(this.settings.contentHtml),a.contentElement.addClass("get"===b?this.settings.contentClassGet:this.settings.contentClassPost),this.contentContainerElement.addContentElement(a.contentElement.get()),a.loadingElement=new Element(this.settings.loadingHtml),a.contentElement.get().appendChild(a.loadingElement.get()),navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&a.contentElement.addClass(this.settings.contentClassIos);var d=new XMLHttpRequest;d.open("get"===b?"GET":"POST",a.target),this.event.addEvent(d,"load",function(){200<=d.status&&300>d.status?(a.contentElement.get().innerHTML=d.responseText,self.event.itemCallback(a),self.settings.executeAjaxScript&&self.executeScript(d.responseText)):(a.contentElement.get().innerHTML="ERROR: could not load content from "+a.target+"!",console.warn(d.statusText,d.responseText))}),d.send("post"===b&&a.data?a.data:null)},this.addContentImage=function(a){a.contentElement=new Element(this.settings.contentHtml),a.contentElement.addClass(this.settings.contentClassImage),this.contentContainerElement.addContentElement(a.contentElement.get()),a.loadingElement=new Element(this.settings.loadingHtml),a.contentElement.get().appendChild(a.loadingElement.get()),this.loadImage(a,function(b,d){switch(b.loadingElement.hideAndRemove(),d){case"error":b.contentElement.get().innerHTML="ERROR: could not load the image from "+b.target+".";break;case"timeout":b.contentElement.get().innerHTML="ERROR: loading the image from "+b.target+" took too long.";break;default:b.contentElement.get().style.backgroundImage="url("+b.target+")",b.title&&1===self.settings.items.length&&(self.infoElement.get().innerHTML=b.title),self.event.itemCallback(b);}},1e3*self.settings.imageLoadTimeout)},this.loadImage=function(a,b,d){d=d||1e3*self.settings.imageLoadTimeout;var g,f=!1,h=new Image;h.onerror=h.onabort=function(){f||(clearTimeout(g),b(a,"error"))},h.onload=function(){f||(clearTimeout(g),b(a,"success"))},h.src=a.target,g=setTimeout(function(){f=!0,h.src="//!!!!/test.jpg",b(a,"timeout")},d)},this.showNextItem=function(){this.dragdealer&&(this.settings.itemsKey=this.settings.itemsKey+1<=this.settings.items.length?this.settings.itemsKey+1:1,this.dragdealer.setStep(this.settings.itemsKey))},this.showPreviousItem=function(){this.dragdealer&&(this.settings.itemsKey=0<this.settings.itemsKey-1?this.settings.itemsKey-1:this.settings.items.length,this.dragdealer.setStep(this.settings.itemsKey))};var NSEvents={on(a,b,d){this.namespaces||(this.namespaces={}),this.namespaces[a]=b;return this.addEventListener(a.split(".")[0],b,d||!1),this},off(a){return this.removeEventListener(a.split(".")[0],this.namespaces[a]),delete this.namespaces[a],this}};this.enableKeyboard=function(){document.on=Element.prototype.on=NSEvents.on,document.off=Element.prototype.off=NSEvents.off,document.on("keydown.Lighbox",function(a){switch(a.which){case 39:1<self.settings.items.length&&self.showNextItem();break;case 37:1<self.settings.items.length&&self.showPreviousItem();break;case 27:!0===self.settings.closeOnBackgroundClick&&self.close();}})},this.disableKeyboard=function(){document.off("keydown.Lighbox")},this.close=function(){return this.backgroundElement&&this.backgroundElement.hideAndRemove(function(){self.backgroundElement=null}),this.closeElement&&this.closeElement.hideAndRemove(function(){self.closeElement=null}),this.contentContainerElement&&(this.contentContainerElement.remove(),this.contentContainerElement=null),this.infoElement&&(this.infoElement.remove(),this.infoElement=null),this.previousElement&&this.previousElement.hideAndRemove(function(){self.previousElement=null}),this.nextElement&&this.nextElement.hideAndRemove(function(){self.nextElement=null}),document.querySelector("html").classList.remove(this.settings.htmlActiveClass),this.disableKeyboard(),this}}"function"==typeof define&&define.amd?define(function(){return Lightbox}):window.Lightbox=Lightbox})(window);